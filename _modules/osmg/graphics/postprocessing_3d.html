<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>osmg.graphics.postprocessing_3d &#8212; osmg 0.2.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=6ffd866b"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for osmg.graphics.postprocessing_3d</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines utility functions used for data visualization.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#</span>
<span class="c1">#   _|_|      _|_|_|  _|      _|    _|_|_|</span>
<span class="c1"># _|    _|  _|        _|_|  _|_|  _|</span>
<span class="c1"># _|    _|    _|_|    _|  _|  _|  _|  _|_|</span>
<span class="c1"># _|    _|        _|  _|      _|  _|    _|</span>
<span class="c1">#   _|_|    _|_|_|    _|      _|    _|_|_|</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># https://github.com/ioannis-vm/OpenSees_Model_Generator</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">transformations</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">graphics_common</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">graphics_common_3d</span>
<span class="kn">from</span> <span class="nn">.preprocessing_3d</span> <span class="kn">import</span> <span class="n">add_data__global_axes</span>
<span class="kn">from</span> <span class="nn">..postprocessing.basic_forces</span> <span class="kn">import</span> <span class="n">basic_forces</span>
<span class="kn">from</span> <span class="nn">..ops</span> <span class="kn">import</span> <span class="n">element</span>
<span class="kn">from</span> <span class="nn">..model</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..solver</span> <span class="kn">import</span> <span class="n">Analysis</span>


<span class="n">nparr</span> <span class="o">=</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>


<div class="viewcode-block" id="force_scaling_factor">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.force_scaling_factor">[docs]</a>
<span class="k">def</span> <span class="nf">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies a scaling factor to basic forces.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      ref_len: :func:`~osmg.model.Model.reference_length` of the</span>
<span class="sd">        model.</span>
<span class="sd">      fmax: Largest value in the basic forces.</span>
<span class="sd">      factor: Required scaling factor.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fmax</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ref_len</span> <span class="o">/</span> <span class="n">fmax</span> <span class="o">*</span> <span class="n">factor</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="interp_3d_deformation">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.interp_3d_deformation">[docs]</a>
<span class="k">def</span> <span class="nf">interp_3d_deformation</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">u_i</span><span class="p">,</span> <span class="n">r_i</span><span class="p">,</span> <span class="n">u_j</span><span class="p">,</span> <span class="n">r_j</span><span class="p">,</span> <span class="n">num_points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the deformations of the ends of a Bernoulli beam,</span>
<span class="sd">    use its shape functions to obtain intermediate points.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      element: A line element</span>
<span class="sd">      u_i: 3 displacements at end i, global system</span>
<span class="sd">      r_i: 3 rotations at end i, global system</span>
<span class="sd">      u_j, r_j: similar to u_i, r_i.</span>
<span class="sd">      num_points: Number of interpolation points</span>

<span class="sd">    Returns:</span>
<span class="sd">      Displacements (global system) and rotations (local system). The</span>
<span class="sd">        rotations are needed for plotting the deformed shape with</span>
<span class="sd">        extruded frame elements.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x_vec</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">x_axis</span>
    <span class="n">y_vec</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">y_axis</span>
    <span class="n">z_vec</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">y_vec</span><span class="p">)</span>

    <span class="c1"># global -&gt; local transformation matrix</span>
    <span class="n">transf_global2local</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">transformation_matrix</span><span class="p">(</span>
        <span class="n">x_vec</span><span class="p">,</span> <span class="n">y_vec</span><span class="p">,</span> <span class="n">z_vec</span>
    <span class="p">)</span>
    <span class="n">transf_local2global</span> <span class="o">=</span> <span class="n">transf_global2local</span><span class="o">.</span><span class="n">T</span>

    <span class="n">u_i_global</span> <span class="o">=</span> <span class="n">u_i</span>
    <span class="n">r_i_global</span> <span class="o">=</span> <span class="n">r_i</span>
    <span class="n">u_j_global</span> <span class="o">=</span> <span class="n">u_j</span>
    <span class="n">r_j_global</span> <span class="o">=</span> <span class="n">r_j</span>

    <span class="n">u_i_local</span> <span class="o">=</span> <span class="n">transf_global2local</span> <span class="o">@</span> <span class="n">u_i_global</span>
    <span class="n">r_i_local</span> <span class="o">=</span> <span class="n">transf_global2local</span> <span class="o">@</span> <span class="n">r_i_global</span>
    <span class="n">u_j_local</span> <span class="o">=</span> <span class="n">transf_global2local</span> <span class="o">@</span> <span class="n">u_j_global</span>
    <span class="n">r_j_local</span> <span class="o">=</span> <span class="n">transf_global2local</span> <span class="o">@</span> <span class="n">r_j_global</span>

    <span class="c1"># discrete sample location parameter</span>
    <span class="n">t_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
    <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
    <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
    <span class="n">len_clr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p_i</span> <span class="o">-</span> <span class="n">p_j</span><span class="p">)</span>

    <span class="c1"># shape function matrices</span>
    <span class="n">nx_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_vec</span><span class="p">,</span> <span class="n">t_vec</span><span class="p">))</span>
    <span class="n">nyz_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="n">t_vec</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_clr</span><span class="p">,</span>
            <span class="mf">3.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_clr</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">nyz_derivative_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="o">-</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">t_vec</span> <span class="o">+</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">t_vec</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_clr</span><span class="p">,</span>
            <span class="mf">6.0</span> <span class="o">*</span> <span class="n">t_vec</span> <span class="o">-</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">t_vec</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">t_vec</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_clr</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># axial deformation</span>
    <span class="n">d_x_local</span> <span class="o">=</span> <span class="n">nx_mat</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># bending deformation along the local xy plane</span>
    <span class="n">d_y_local</span> <span class="o">=</span> <span class="n">nyz_mat</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">u_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_j_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="p">)</span>

    <span class="c1"># bending deformation along the local xz plane</span>
    <span class="n">d_z_local</span> <span class="o">=</span> <span class="n">nyz_mat</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">u_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">r_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">r_j_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="p">)</span>

    <span class="c1"># torsional deformation</span>
    <span class="n">r_x_local</span> <span class="o">=</span> <span class="n">nx_mat</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># bending rotation around the local z axis</span>
    <span class="n">r_z_local</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">nyz_derivative_mat</span>
<div class="viewcode-block" id="interp_3d_points">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.interp_3d_points">[docs]</a>
        <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_j_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="o">/</span> <span class="n">len_clr</span>
    <span class="p">)</span>

    <span class="c1"># bending rotation around the local y axis</span>
    <span class="n">r_y_local</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">nyz_derivative_mat</span>
        <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">u_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">u_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r_j_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="o">/</span> <span class="n">len_clr</span>
    <span class="p">)</span>

    <span class="c1"># all deformations</span>
    <span class="n">d_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">d_x_local</span><span class="p">,</span> <span class="n">d_y_local</span><span class="p">,</span> <span class="n">d_z_local</span><span class="p">))</span>

    <span class="c1"># all rotations</span>
    <span class="n">r_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">r_x_local</span><span class="p">,</span> <span class="n">r_y_local</span><span class="p">,</span> <span class="n">r_z_local</span><span class="p">))</span>

    <span class="n">d_global</span> <span class="o">=</span> <span class="p">(</span><span class="n">transf_local2global</span> <span class="o">@</span> <span class="n">d_local</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">d_global</span><span class="p">,</span> <span class="n">r_local</span></div>



<span class="k">def</span> <span class="nf">interp_3d_points</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">d_global</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates intermediate points based on end locations and</span>
<span class="sd">    deformations.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
        <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
        <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
    <span class="n">element_point_samples</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">interpolation_points</span> <span class="o">=</span> <span class="n">element_point_samples</span> <span class="o">+</span> <span class="n">d_global</span> <span class="o">*</span> <span class="n">scaling</span>

    <span class="k">return</span> <span class="n">interpolation_points</span></div>



<div class="viewcode-block" id="add_data__extruded_line_elms_deformed_mesh">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.add_data__extruded_line_elms_deformed_mesh">[docs]</a>
<span class="k">def</span> <span class="nf">add_data__extruded_line_elms_deformed_mesh</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">scaling</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a trace containing frame element extrusion mesh</span>
<span class="sd">    in its deformed state.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">x_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">j_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">intensity</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_when_extruded</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">outside_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">outside_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="n">num_points</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="c1"># translations and rotations at the offset ends</span>
        <span class="n">u_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">u_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="c1"># transferring them to the clear element ends</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="n">offset_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">offset_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">x_vec</span><span class="p">,</span>
                <span class="n">y_vec</span><span class="p">,</span>
                <span class="n">z_vec</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">local_axes_from_points_and_angle</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
                <span class="mf">0.00</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">outside_shape</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">outside_shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset_i</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">offset_j</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
            <span class="n">x_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">x_axis</span>
            <span class="n">y_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">y_axis</span>
            <span class="n">z_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">z_axis</span>
            <span class="n">outside_shape</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">outside_shape</span>
        <span class="n">u_i_o</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_i</span><span class="p">,</span> <span class="n">u_i</span><span class="p">,</span> <span class="n">r_i</span><span class="p">)</span>
        <span class="n">u_j_o</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_j</span><span class="p">,</span> <span class="n">u_j</span><span class="p">,</span> <span class="n">r_j</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="n">d_global</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">r_local</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_points</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">interpolation_points</span> <span class="o">=</span> <span class="n">interp_3d_points</span><span class="p">(</span>
                <span class="n">elm</span><span class="p">,</span> <span class="n">d_global</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">scaling</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_global</span><span class="p">,</span> <span class="n">r_local</span> <span class="o">=</span> <span class="n">interp_3d_deformation</span><span class="p">(</span>
                <span class="n">elm</span><span class="p">,</span> <span class="n">u_i_o</span><span class="p">,</span> <span class="n">r_i</span><span class="p">,</span> <span class="n">u_j_o</span><span class="p">,</span> <span class="n">r_j</span><span class="p">,</span> <span class="n">num_points</span>
            <span class="p">)</span>
            <span class="n">interpolation_points</span> <span class="o">=</span> <span class="n">interp_3d_points</span><span class="p">(</span>
                <span class="n">elm</span><span class="p">,</span> <span class="n">d_global</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">scaling</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">loc_i_global</span> <span class="o">=</span> <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">loc_j_global</span> <span class="o">=</span> <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">rot_i_local</span> <span class="o">=</span> <span class="n">r_local</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">rot_j_local</span> <span class="o">=</span> <span class="n">r_local</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">assert</span> <span class="n">outside_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">outside_shape</span><span class="o">.</span><span class="n">halfedges</span>
            <span class="k">for</span> <span class="n">halfedge</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">halfedge</span><span class="o">.</span><span class="n">nxt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">z_a</span> <span class="o">=</span> <span class="n">halfedge</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_a</span> <span class="o">=</span> <span class="n">halfedge</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z_b</span> <span class="o">=</span> <span class="n">halfedge</span><span class="o">.</span><span class="n">nxt</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_b</span> <span class="o">=</span> <span class="n">halfedge</span><span class="o">.</span><span class="n">nxt</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defo_ia_global</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">z_a</span> <span class="o">*</span> <span class="n">z_vec</span>
                    <span class="o">+</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="o">+</span> <span class="p">(</span>
                        <span class="o">-</span><span class="n">rot_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_a</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">z_vec</span>
                        <span class="o">-</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_a</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">scaling</span>
                <span class="p">)</span>
                <span class="n">defo_ja_global</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">z_a</span> <span class="o">*</span> <span class="n">z_vec</span>
                    <span class="o">+</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="o">+</span> <span class="p">(</span>
                        <span class="o">-</span><span class="n">rot_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_j_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_a</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_a</span> <span class="o">*</span> <span class="n">z_vec</span>
                        <span class="o">-</span> <span class="n">rot_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_a</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">scaling</span>
                <span class="p">)</span>
                <span class="n">defo_ib_global</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">z_b</span> <span class="o">*</span> <span class="n">z_vec</span>
                    <span class="o">+</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="o">+</span> <span class="p">(</span>
                        <span class="o">-</span><span class="n">rot_i_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_b</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">z_vec</span>
                        <span class="o">-</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_b</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">scaling</span>
                <span class="p">)</span>
                <span class="n">defo_jb_global</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">z_b</span> <span class="o">*</span> <span class="n">z_vec</span>
                    <span class="o">+</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="o">+</span> <span class="p">(</span>
                        <span class="o">-</span><span class="n">rot_j_local</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_i_local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_b</span> <span class="o">*</span> <span class="n">x_vec</span>
                        <span class="o">+</span> <span class="n">rot_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_b</span> <span class="o">*</span> <span class="n">z_vec</span>
                        <span class="o">-</span> <span class="n">rot_j_local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_b</span> <span class="o">*</span> <span class="n">y_vec</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">scaling</span>
                <span class="p">)</span>
                <span class="n">loc0</span> <span class="o">=</span> <span class="n">loc_i_global</span> <span class="o">+</span> <span class="n">defo_ia_global</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="n">loc_j_global</span> <span class="o">+</span> <span class="n">defo_ja_global</span>
                <span class="n">loc2</span> <span class="o">=</span> <span class="n">loc_j_global</span> <span class="o">+</span> <span class="n">defo_jb_global</span>
                <span class="n">loc3</span> <span class="o">=</span> <span class="n">loc_i_global</span> <span class="o">+</span> <span class="n">defo_ib_global</span>
                <span class="n">x_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">loc0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc3</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">y_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">loc0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc3</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">z_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">loc0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">loc1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">loc2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">loc3</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">i_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">index</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">j_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">k_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_global</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">d_global</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="p">)</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_global</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">d_global</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="p">)</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_global</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">d_global</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="p">)</span>
                <span class="n">intensity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_global</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">d_global</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="n">data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mesh3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x_list</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y_list</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z_list</span><span class="p">,</span>
            <span class="s2">&quot;colorscale&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]],</span>
            <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">i_list</span><span class="p">,</span>
            <span class="s2">&quot;j&quot;</span><span class="p">:</span> <span class="n">j_list</span><span class="p">,</span>
            <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="n">k_list</span><span class="p">,</span>
            <span class="s2">&quot;intensity&quot;</span><span class="p">:</span> <span class="n">intensity</span><span class="p">,</span>
            <span class="s2">&quot;colorbar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Displacement&quot;</span><span class="p">,</span> <span class="s2">&quot;ypad&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
            <span class="s2">&quot;hoverinfo&quot;</span><span class="p">:</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;opacity&quot;</span><span class="p">:</span> <span class="mf">0.65</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_data__line_elms_deformed">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.add_data__line_elms_deformed">[docs]</a>
<span class="k">def</span> <span class="nf">add_data__line_elms_deformed</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">scaling</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a trace containing frame element centroidal axis lines</span>
<span class="sd">    in their deformed state.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">x_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_at_line_plots</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">num_points</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">u_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">u_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="c1"># transferring them to the clear element ends</span>
            <span class="n">offset_i</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">offset_j</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
            <span class="n">u_i_o</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_i</span><span class="p">,</span> <span class="n">u_i</span><span class="p">,</span> <span class="n">r_i</span><span class="p">)</span>
            <span class="n">u_j_o</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_j</span><span class="p">,</span> <span class="n">u_j</span><span class="p">,</span> <span class="n">r_j</span><span class="p">)</span>
            <span class="n">d_global</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">interp_3d_deformation</span><span class="p">(</span>
                <span class="n">elm</span><span class="p">,</span> <span class="n">u_i_o</span><span class="p">,</span> <span class="n">r_i</span><span class="p">,</span> <span class="n">u_j_o</span><span class="p">,</span> <span class="n">r_j</span><span class="p">,</span> <span class="n">num_points</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># for a truss member, just connect the two ends</span>
            <span class="n">d_global</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">u_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num_points</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">interpolation_points</span> <span class="o">=</span> <span class="n">interp_3d_points</span><span class="p">(</span>
            <span class="n">elm</span><span class="p">,</span> <span class="n">d_global</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">scaling</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">interpolation_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">y_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">z_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">interpolation_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x_list</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y_list</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z_list</span><span class="p">,</span>
            <span class="s2">&quot;hoverinfo&quot;</span><span class="p">:</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">graphics_common</span><span class="o">.</span><span class="n">FRAME_COLOR</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_data__line_elm_offsets_deformed">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.add_data__line_elm_offsets_deformed">[docs]</a>
<span class="k">def</span> <span class="nf">add_data__line_elm_offsets_deformed</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">scaling</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a trace containing frame element rigid offset lines</span>
<span class="sd">    in their deformed state.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">x_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                <span class="k">continue</span>
        <span class="n">p_i</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">p_io</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
        <span class="n">offset_i</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
        <span class="n">u_i</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
                <span class="n">step</span>
            <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">r_i</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
                <span class="n">step</span>
            <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">u_io</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_i</span><span class="p">,</span> <span class="n">u_i</span><span class="p">,</span> <span class="n">r_i</span><span class="p">)</span>

        <span class="n">p_j</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">p_jo</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
        <span class="n">offset_j</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
        <span class="n">u_j</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
                <span class="n">step</span>
            <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">r_j</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
                <span class="n">step</span>
            <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">u_jo</span><span class="p">:</span> <span class="n">nparr</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">offset_transformation</span><span class="p">(</span><span class="n">offset_j</span><span class="p">,</span> <span class="n">u_j</span><span class="p">,</span> <span class="n">r_j</span><span class="p">)</span>

        <span class="n">x_i</span> <span class="o">=</span> <span class="n">p_i</span> <span class="o">+</span> <span class="n">u_i</span> <span class="o">*</span> <span class="n">scaling</span>
        <span class="n">x_io</span> <span class="o">=</span> <span class="n">p_io</span> <span class="o">+</span> <span class="n">u_io</span> <span class="o">*</span> <span class="n">scaling</span>
        <span class="n">x_j</span> <span class="o">=</span> <span class="n">p_j</span> <span class="o">+</span> <span class="n">u_j</span> <span class="o">*</span> <span class="n">scaling</span>
        <span class="n">x_jo</span> <span class="o">=</span> <span class="n">p_jo</span> <span class="o">+</span> <span class="n">u_jo</span> <span class="o">*</span> <span class="n">scaling</span>

        <span class="n">x_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_io</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">y_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_io</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">z_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x_io</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">x_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_jo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">y_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_jo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">z_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">x_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x_jo</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x_list</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y_list</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z_list</span><span class="p">,</span>
            <span class="s2">&quot;hoverinfo&quot;</span><span class="p">:</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">graphics_common</span><span class="o">.</span><span class="n">OFFSET_COLOR</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_data__frames_undeformed">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.add_data__frames_undeformed">[docs]</a>
<span class="k">def</span> <span class="nf">add_data__frames_undeformed</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a trace containing frame element centroidal axis lines</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elems</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">):</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>

        <span class="n">x_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">y_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">z_list</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x_list</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y_list</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z_list</span><span class="p">,</span>
            <span class="s2">&quot;hoverinfo&quot;</span><span class="p">:</span> <span class="s2">&quot;skip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">graphics_common</span><span class="o">.</span><span class="n">BEAM_MESH_COLOR</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="add_data__nodes_deformed">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.add_data__nodes_deformed">[docs]</a>
<span class="k">def</span> <span class="nf">add_data__nodes_deformed</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_nodes</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">function</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a trace containing nodes in their deformed locations.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ids_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">]</span>
    <span class="n">location_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_nodes</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="mf">0.00</span><span class="p">)</span>
    <span class="n">displacement_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_nodes</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span> <span class="mf">0.00</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_nodes</span><span class="p">):</span>
        <span class="n">location_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">coords</span>
        <span class="n">displacement_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span>
            <span class="n">case_name</span>
        <span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span><span class="n">step</span><span class="p">]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">+</span> <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">+</span> <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_list</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">displacement_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">displacement_data</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">ids</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">restraint_symbols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">restraint</span><span class="p">:</span>
            <span class="n">restraint_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;fixed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restraint_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">graphics_common_3d</span><span class="o">.</span><span class="n">node_marker</span><span class="p">[</span><span class="n">sym</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">restraint_symbols</span>
    <span class="p">]</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">graphics_common_3d</span><span class="o">.</span><span class="n">node_marker</span><span class="p">[</span><span class="n">sym</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">restraint_symbols</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">function</span> <span class="o">==</span> <span class="s2">&quot;internal&quot;</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">graphics_common</span><span class="o">.</span><span class="n">NODE_INTERNAL_COLOR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">graphics_common</span><span class="o">.</span><span class="n">NODE_PRIMARY_COLOR</span>

    <span class="n">data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;markers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">location_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">location_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">location_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">displacement_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">displacement_data</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;ux: %</span><span class="si">{customdata[0]:.6g}</span><span class="s2">&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;uy: %</span><span class="si">{customdata[1]:.6g}</span><span class="s2">&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;uz: %</span><span class="si">{customdata[2]:.6g}</span><span class="s2">&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;combined: %</span><span class="si">{customdata[6]:.6g}</span><span class="s2">&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;rx: %</span><span class="si">{customdata[3]:.6g}</span><span class="s2"> (rad)&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;ry: %</span><span class="si">{customdata[4]:.6g}</span><span class="s2"> (rad)&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;rz: %</span><span class="si">{customdata[5]:.6g}</span><span class="s2"> (rad)&lt;br&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;&lt;extra&gt;Node %</span><span class="si">{customdata[7]:d}</span><span class="s2">&lt;/extra&gt;&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">marker</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="get_auto_scaling_deformation">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.get_auto_scaling_deformation">[docs]</a>
<span class="k">def</span> <span class="nf">get_auto_scaling_deformation</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">mdl</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically calculate a scaling value that makes the maximum</span>
<span class="sd">    displacement appear approximately 10% of the largest dimention of</span>
<span class="sd">    the building&#39;s bounding box.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>
    <span class="c1"># maximum displacement</span>
    <span class="n">max_d</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="n">elms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">))</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">elms</span><span class="p">:</span>
        <span class="n">u_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_i</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">u_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">r_j</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">case_name</span><span class="p">]</span><span class="o">.</span><span class="n">node_displacements</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">uid</span><span class="p">][</span>
            <span class="n">step</span>
        <span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">d_global</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">interp_3d_deformation</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">u_i</span><span class="p">,</span> <span class="n">r_i</span><span class="p">,</span> <span class="n">u_j</span><span class="p">,</span> <span class="n">r_j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">max_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">max_d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d_global</span><span class="p">)))</span>
    <span class="c1"># scaling factor: max_d scaled = 10% of the reference length</span>
    <span class="k">if</span> <span class="n">max_d</span> <span class="o">&gt;</span> <span class="mf">1.00e-14</span><span class="p">:</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">ref_len</span> <span class="o">/</span> <span class="n">max_d</span> <span class="o">*</span> <span class="mf">0.1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># no infinite scaling, thank you</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.00</span>

    <span class="c1"># never scale things down</span>
    <span class="c1"># (usually when this is required, things have gone bad</span>
    <span class="c1">#  and we should be able to realize that immediately)</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scaling</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scaling</span></div>



<div class="viewcode-block" id="show_deformed_shape">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.show_deformed_shape">[docs]</a>
<span class="k">def</span> <span class="nf">show_deformed_shape</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">:</span> <span class="n">Analysis</span><span class="p">,</span>
    <span class="n">case_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">scaling</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">extrude</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">camera</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">subset_model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">animation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">init_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">step_skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">to_html_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the model in its deformed state</span>

<span class="sd">    Arguments:</span>
<span class="sd">      analysis: an analysis object</span>
<span class="sd">      case_name: the name of the load_case to be visualized</span>
<span class="sd">      step: the analysis step to be visualized</span>
<span class="sd">      scaling: scaling factor for the deformations. If 0.00 is</span>
<span class="sd">        provided, the scaling factor is calculated automatically.</span>
<span class="sd">      extrude: wether to extrude frame elements</span>
<span class="sd">      camera: custom positioning of the camera</span>
<span class="sd">      subset_model: subset model used to only show certain</span>
<span class="sd">        components</span>
<span class="sd">      animation: show all frames up to the one identified with</span>
<span class="sd">        `step`</span>
<span class="sd">      init_step: starting step, in case of animation</span>
<span class="sd">      step_skip: how many frames to skip to reduce the number of</span>
<span class="sd">        frames in case an animation.</span>
<span class="sd">      to_html_file: If a path is specified, the figure is written in</span>
<span class="sd">        an html file instead of being shown.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_model</span><span class="p">:</span>
        <span class="c1"># if a subset model is specified, only show its components</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">subset_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise show the entire model</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">mdl</span>

    <span class="c1"># calculate a nice scaling factor if 0.00 is passed</span>
    <span class="k">if</span> <span class="n">scaling</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">get_auto_scaling_deformation</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">mdl</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="c1"># instantiate layout and datastructures</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">graphics_common_3d</span><span class="o">.</span><span class="n">global_layout</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">camera</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">frame_data_dict</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># gather lists of associated objects</span>
    <span class="n">list_of_line_elems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_of_line_elems</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">))</span>
    <span class="n">list_of_line_elems</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">list_of_line_elems</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">list_of_primary_nodes</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">list_of_primary_nodes</span><span class="p">()</span>
    <span class="n">list_of_internal_nodes</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">list_of_internal_nodes</span><span class="p">()</span>
    <span class="c1"># list_of_parent_nodes = mdl.list_of_parent_nodes()</span>

    <span class="c1"># add data for the global axes</span>
    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>

    <span class="n">add_data__global_axes</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">ref_len</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">animation</span><span class="p">:</span>
        <span class="n">first_step</span> <span class="o">=</span> <span class="n">init_step</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">first_step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="n">add_data__nodes_deformed</span><span class="p">(</span>
        <span class="n">analysis</span><span class="p">,</span>
        <span class="n">case_name</span><span class="p">,</span>
        <span class="n">data_dict</span><span class="p">,</span>
        <span class="n">list_of_primary_nodes</span><span class="p">,</span>
        <span class="n">first_step</span><span class="p">,</span>
        <span class="n">scaling</span><span class="p">,</span>
        <span class="s2">&quot;free&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">add_data__nodes_deformed</span><span class="p">(</span>
        <span class="n">analysis</span><span class="p">,</span>
        <span class="n">case_name</span><span class="p">,</span>
        <span class="n">data_dict</span><span class="p">,</span>
        <span class="n">list_of_internal_nodes</span><span class="p">,</span>
        <span class="n">first_step</span><span class="p">,</span>
        <span class="n">scaling</span><span class="p">,</span>
        <span class="s2">&quot;internal&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># add data for the frame elements as lines</span>
    <span class="n">add_data__line_elm_offsets_deformed</span><span class="p">(</span>
        <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">,</span> <span class="n">first_step</span><span class="p">,</span> <span class="n">scaling</span>
    <span class="p">)</span>
    <span class="n">add_data__line_elms_deformed</span><span class="p">(</span>
        <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elems</span><span class="p">,</span> <span class="n">first_step</span><span class="p">,</span> <span class="n">scaling</span>
    <span class="p">)</span>
    <span class="c1"># add data for the extruded frame elements</span>
    <span class="k">if</span> <span class="n">extrude</span><span class="p">:</span>
        <span class="n">add_data__extruded_line_elms_deformed_mesh</span><span class="p">(</span>
            <span class="n">analysis</span><span class="p">,</span>
            <span class="n">case_name</span><span class="p">,</span>
            <span class="n">data_dict</span><span class="p">,</span>
            <span class="n">list_of_line_elems</span><span class="p">,</span>
            <span class="n">first_step</span><span class="p">,</span>
            <span class="n">scaling</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># create the plot</span>

    <span class="k">def</span> <span class="nf">frame_args</span><span class="p">(</span><span class="n">duration</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">},</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;immediate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fromcurrent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;transition&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span> <span class="s2">&quot;easing&quot;</span><span class="p">:</span> <span class="s2">&quot;linear&quot;</span><span class="p">},</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">animation</span><span class="p">:</span>
        <span class="n">step_of_frame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">first_step</span><span class="p">,</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step_skip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">step_of_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_of_frame</span><span class="p">):</span>
            <span class="n">frame_data_dict</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">add_data__global_axes</span><span class="p">(</span><span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ref_len</span><span class="p">)</span>
            <span class="c1"># add_data__global_axes(frame_data_dict[0], ref_len)</span>
            <span class="n">add_data__nodes_deformed</span><span class="p">(</span>
                <span class="n">analysis</span><span class="p">,</span>
                <span class="n">case_name</span><span class="p">,</span>
                <span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">list_of_primary_nodes</span><span class="p">,</span>
                <span class="n">j</span><span class="p">,</span>
                <span class="n">scaling</span><span class="p">,</span>
                <span class="s2">&quot;free&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">add_data__nodes_deformed</span><span class="p">(</span>
                <span class="n">analysis</span><span class="p">,</span>
                <span class="n">case_name</span><span class="p">,</span>
                <span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">list_of_internal_nodes</span><span class="p">,</span>
                <span class="n">j</span><span class="p">,</span>
                <span class="n">scaling</span><span class="p">,</span>
                <span class="s2">&quot;internal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># add data for the frame elements as lines</span>
            <span class="n">add_data__line_elm_offsets_deformed</span><span class="p">(</span>
                <span class="n">analysis</span><span class="p">,</span>
                <span class="n">case_name</span><span class="p">,</span>
                <span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">list_of_line_elems</span><span class="p">,</span>
                <span class="n">j</span><span class="p">,</span>
                <span class="n">scaling</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">add_data__line_elms_deformed</span><span class="p">(</span>
                <span class="n">analysis</span><span class="p">,</span>
                <span class="n">case_name</span><span class="p">,</span>
                <span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">list_of_line_elems</span><span class="p">,</span>
                <span class="n">j</span><span class="p">,</span>
                <span class="n">scaling</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># add data for the extruded frame elements</span>
            <span class="k">if</span> <span class="n">extrude</span><span class="p">:</span>
                <span class="n">add_data__extruded_line_elms_deformed_mesh</span><span class="p">(</span>
                    <span class="n">analysis</span><span class="p">,</span>
                    <span class="n">case_name</span><span class="p">,</span>
                    <span class="n">frame_data_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">list_of_line_elems</span><span class="p">,</span>
                    <span class="n">j</span><span class="p">,</span>
                    <span class="n">scaling</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">fig_datastructure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
            <span class="n">frames</span><span class="o">=</span><span class="p">[</span>
                <span class="n">go</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">frame_data_dict</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">step_of_frame</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_of_frame</span><span class="p">))</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">fig_datastructure</span><span class="p">)</span>
        <span class="n">sliders</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">},</span>
                <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">frame_args</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
                        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;animate&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="c1"># Layout</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;buttons&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">frame_args</span><span class="p">(</span><span class="mi">50</span><span class="p">)],</span>
                            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;#9654;&quot;</span><span class="p">,</span>  <span class="c1"># play symbol</span>
                            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;animate&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="kc">None</span><span class="p">],</span> <span class="n">frame_args</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;#9724;&quot;</span><span class="p">,</span>  <span class="c1"># pause symbol</span>
                            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;animate&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">},</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="n">sliders</span><span class="o">=</span><span class="n">sliders</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># (not animation)</span>
        <span class="n">fig_datastructure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">fig_datastructure</span><span class="p">)</span>

    <span class="c1"># show the plot (if it&#39;s not a test)</span>
    <span class="k">if</span> <span class="s2">&quot;pytest&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">to_html_file</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">to_html_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># return plot-related metadata</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scaling&quot;</span><span class="p">:</span> <span class="n">scaling</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="show_basic_forces">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.show_basic_forces">[docs]</a>
<span class="k">def</span> <span class="nf">show_basic_forces</span><span class="p">(</span>
    <span class="n">analysis</span><span class="p">,</span>
    <span class="n">case_name</span><span class="p">,</span>
    <span class="n">step</span><span class="p">,</span>
    <span class="n">scaling_global</span><span class="p">,</span>
    <span class="n">scaling_n</span><span class="p">,</span>
    <span class="n">scaling_q</span><span class="p">,</span>
    <span class="n">scaling_m</span><span class="p">,</span>
    <span class="n">scaling_t</span><span class="p">,</span>
    <span class="n">num_points</span><span class="p">,</span>
    <span class="n">force_conversion</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
    <span class="n">moment_conversion</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
    <span class="n">global_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subset_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">to_html_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the model and plot the frame element basic forces.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      analysis: an analysis object</span>
<span class="sd">      case_name: the name of the load_case to be visualized</span>
<span class="sd">      step: the analysis step to be visualized</span>
<span class="sd">      scaling_global: I don&#39;t even remember what this</span>
<span class="sd">        does. It&#39;s kind of a mess right now.</span>
<span class="sd">      scaling_n:</span>
<span class="sd">      scaling_q:</span>
<span class="sd">      scaling_m:</span>
<span class="sd">      scaling_t:</span>
<span class="sd">      num_points: number of points to include in the basic force</span>
<span class="sd">        curves</span>
<span class="sd">      force_conversion: Conversion factor to be applied at the</span>
<span class="sd">        hover box data for forces (for unit conversions)</span>
<span class="sd">      moment_conversion: Conversion factor to be applied at the</span>
<span class="sd">        hover box data for moments (for unit conversions)</span>
<span class="sd">      global_axes: whether to show global axes</span>
<span class="sd">      camera: custom positioning of the camera</span>
<span class="sd">      subset_model: use this model instead of the one contained in the</span>
<span class="sd">        analysis object. It needs to be a subset of the original</span>
<span class="sd">        model. This can be used to only show the results for some part</span>
<span class="sd">        of a large model.</span>
<span class="sd">      to_html_file: If a path is specified, the figure is written in</span>
<span class="sd">        an html file instead of being shown.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">subset_model</span><span class="p">:</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">subset_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">mdl</span>

    <span class="n">elms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">))</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">))</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">))</span>

    <span class="n">list_of_line_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">elm</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">elms</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">skip_opensees_definition</span>
    <span class="p">]</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">graphics_common_3d</span><span class="o">.</span><span class="n">global_layout</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">camera</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># draw the frames</span>
    <span class="n">add_data__frames_undeformed</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elements</span><span class="p">)</span>
    <span class="c1"># we also add axes so that we can see 2D plots</span>
    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">global_axes</span><span class="p">:</span>
        <span class="n">add_data__global_axes</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">ref_len</span><span class="p">)</span>

    <span class="c1"># Plot options:</span>
    <span class="c1"># a: axial</span>
    <span class="c1"># b: shear in local Y and Z</span>
    <span class="c1"># c: moment in Y and Z</span>
    <span class="c1"># d: torsion</span>
    <span class="c1"># e: shear combined</span>
    <span class="c1"># f: moment combined</span>
    <span class="n">x1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_e</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_e</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_e</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_e</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_e</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_f</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_f</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_f</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_f</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_f</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># (we do this to determine the internal forces</span>
    <span class="c1">#  for all elements before we even start plotting</span>
    <span class="c1">#  them, to be able to compute a nice scaling factor</span>
    <span class="c1">#  without having to then recalculate the basic forces)</span>
    <span class="n">nx_vecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qy_vecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qz_vecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tx_vecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mz_vecs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">my_vecs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_basic_forces</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">forces</span> <span class="o">=</span> <span class="n">basic_forces</span><span class="p">(</span>
            <span class="n">analysis</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">elm</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forces</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="n">nx_vec</span><span class="p">,</span> <span class="n">qy_vec</span><span class="p">,</span> <span class="n">qz_vec</span><span class="p">,</span> <span class="n">tx_vec</span><span class="p">,</span> <span class="n">mz_vec</span><span class="p">,</span> <span class="n">my_vec</span> <span class="o">=</span> <span class="n">forces</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nx_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qy_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qz_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tx_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mz_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_vec</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="c1"># store results in the preallocated arrays</span>

        <span class="n">nx_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx_vec</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qy_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">qy_vec</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qz_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">qz_vec</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">tx_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx_vec</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">my_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_vec</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">mz_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">mz_vec</span> <span class="o">*</span> <span class="n">moment_conversion</span>

    <span class="c1"># calculate scaling factors</span>
    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">nx_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx_vecs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
    <span class="n">scaling_n</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">nx_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_n</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_t</span> <span class="o">=</span> <span class="mf">1.00</span>
    <span class="n">qy_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">qy_vecs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
    <span class="n">qz_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">qz_vecs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
    <span class="n">scaling_qy</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">qy_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="n">scaling_qz</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">qz_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_qy</span> <span class="o">&gt;</span> <span class="mf">0.00</span> <span class="ow">and</span> <span class="n">scaling_qz</span> <span class="o">&gt;</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">scaling_qy</span><span class="p">,</span> <span class="n">scaling_qz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scaling_qy</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">scaling_qz</span>
    <span class="k">elif</span> <span class="n">scaling_qz</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">scaling_qy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">if</span> <span class="n">scaling_q</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="mf">1.00</span>
    <span class="n">my_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">my_vecs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
    <span class="n">mz_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mz_vecs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>
    <span class="n">scaling_my</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">my_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="n">scaling_mz</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">mz_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_my</span> <span class="o">&gt;</span> <span class="mf">0.00</span> <span class="ow">and</span> <span class="n">scaling_mz</span> <span class="o">&gt;</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">scaling_my</span><span class="p">,</span> <span class="n">scaling_mz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scaling_my</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">scaling_mz</span>
    <span class="k">elif</span> <span class="n">scaling_mz</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">scaling_my</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">if</span> <span class="n">scaling_m</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="mf">1.00</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_basic_forces</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># retrieve results from the preallocated arrays</span>
        <span class="n">nx_vec</span> <span class="o">=</span> <span class="n">nx_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qy_vec</span> <span class="o">=</span> <span class="n">qy_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qz_vec</span> <span class="o">=</span> <span class="n">qz_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">tx_vec</span> <span class="o">=</span> <span class="n">tx_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">my_vec</span> <span class="o">=</span> <span class="n">my_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">mz_vec</span> <span class="o">=</span> <span class="n">mz_vecs</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">elm</span><span class="p">,</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">x_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">x_axis</span>
            <span class="n">y_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">y_axis</span>
            <span class="n">z_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">z_axis</span>
            <span class="n">i_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">i_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">x_vec</span><span class="p">,</span>
                <span class="n">y_vec</span><span class="p">,</span>
                <span class="n">z_vec</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">local_axes_from_points_and_angle</span><span class="p">(</span>
                <span class="n">p_i</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="mf">0.00</span>
            <span class="p">)</span>

        <span class="n">len_clr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p_i</span> <span class="o">-</span> <span class="n">p_j</span><span class="p">)</span>
        <span class="n">t_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">len_clr</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p_start</span> <span class="o">=</span> <span class="n">i_pos</span> <span class="o">+</span> <span class="n">t_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vec</span>
            <span class="n">p_end</span> <span class="o">=</span> <span class="n">i_pos</span> <span class="o">+</span> <span class="n">t_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vec</span>

            <span class="c1"># axial load</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">nx_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">+</span> <span class="n">nx_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>

            <span class="n">x1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">nx_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># torsion</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">tx_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">+</span> <span class="n">tx_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">x1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">tx_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tx_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;orange&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># shear load on y and z axes</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">+</span> <span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># moment around z and y axes</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">-</span> <span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="c1"># note: moments plotted upside down!</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="c1"># moment around y axis</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">-</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">my_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># shear load combined</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_start</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">scaling_q</span>
                <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">scaling_q</span>
                <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_e</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_e</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_e</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_e</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">qy_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">qz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">colors1_e</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># both moments combined!</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_start</span>
                <span class="o">-</span> <span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span>
                <span class="o">-</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span>
                <span class="o">-</span> <span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span>
                <span class="o">-</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="c1"># note: moments plotted upside down!</span>
            <span class="n">x1_f</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_f</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_f</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_f</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mz_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">my_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">colors1_f</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">dt_a</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_a</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_a</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_a</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_a</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_a</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_b</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_b</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_b</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_b</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_b</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_b</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_c</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_c</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_c</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_c</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_c</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_c</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_d</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_d</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_d</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_d</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_d</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_d</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_e</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_e</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_e</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_e</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_e</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_e</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_f</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_f</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_f</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_f</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_f</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_f</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="n">fig_datastructure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span> <span class="o">+</span> <span class="n">dt_a</span> <span class="o">+</span> <span class="n">dt_b</span> <span class="o">+</span> <span class="n">dt_c</span> <span class="o">+</span> <span class="n">dt_d</span> <span class="o">+</span> <span class="n">dt_e</span> <span class="o">+</span> <span class="n">dt_f</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">fig_datastructure</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
                <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Axial&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Shear&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moment&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Torsion&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Shear (combined)&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moment (combined)&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;pytest&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">to_html_file</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">to_html_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;scaling_n&quot;</span><span class="p">:</span> <span class="n">scaling_n</span><span class="p">,</span>
        <span class="s2">&quot;scaling_q&quot;</span><span class="p">:</span> <span class="n">scaling_q</span><span class="p">,</span>
        <span class="s2">&quot;scaling_m&quot;</span><span class="p">:</span> <span class="n">scaling_m</span><span class="p">,</span>
        <span class="s2">&quot;scaling_t&quot;</span><span class="p">:</span> <span class="n">scaling_t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">metadata</span></div>



<div class="viewcode-block" id="show_basic_forces_combo">
<a class="viewcode-back" href="../../../_autosummary/osmg.graphics.postprocessing_3d.html#osmg.graphics.postprocessing_3d.show_basic_forces_combo">[docs]</a>
<span class="k">def</span> <span class="nf">show_basic_forces_combo</span><span class="p">(</span>
    <span class="n">combo</span><span class="p">,</span>
    <span class="n">scaling_global</span><span class="p">,</span>
    <span class="n">scaling_n</span><span class="p">,</span>
    <span class="n">scaling_q</span><span class="p">,</span>
    <span class="n">scaling_m</span><span class="p">,</span>
    <span class="n">scaling_t</span><span class="p">,</span>
    <span class="n">num_points</span><span class="p">,</span>
    <span class="n">force_conversion</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
    <span class="n">moment_conversion</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
    <span class="n">global_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subset_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">to_html_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the model and plot the enveloped frame element basic forces</span>
<span class="sd">    for a load combination.</span>

<span class="sd">    Arguments:</span>
<span class="sd">      combo: a load combination object</span>
<span class="sd">      step: the analysis step to be visualized</span>
<span class="sd">      scaling_global: I don&#39;t even remember what this</span>
<span class="sd">        does. It&#39;s kind of a mess right now.</span>
<span class="sd">      scaling_n:</span>
<span class="sd">      scaling_q:</span>
<span class="sd">      scaling_m:</span>
<span class="sd">      scaling_t:</span>
<span class="sd">      num_points: number of points to include in the basic force</span>
<span class="sd">        curves</span>
<span class="sd">      force_conversion: Conversion factor to be applied at the</span>
<span class="sd">        hover box data for forces (for unit conversions)</span>
<span class="sd">      moment_conversion: Conversion factor to be applied at the</span>
<span class="sd">        hover box data for moments (for unit conversions)</span>
<span class="sd">      global_axes: whether to show global axes</span>
<span class="sd">      camera: custom positioning of the camera</span>
<span class="sd">      subset_model: use this model instead of the one contained in the</span>
<span class="sd">        analysis object. It needs to be a subset of the original</span>
<span class="sd">        model. This can be used to only show the results for some part</span>
<span class="sd">        of a large model.</span>
<span class="sd">      to_html_file: If a path is specified, the figure is written in</span>
<span class="sd">        an html file instead of being shown.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: merge code repetitions with the previous function</span>

    <span class="k">if</span> <span class="n">subset_model</span><span class="p">:</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">subset_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">mdl</span>
    <span class="n">elms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">TrussBar</span><span class="p">))</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">))</span>
    <span class="n">elms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">list_of_specific_element</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">))</span>
    <span class="n">list_of_line_elements</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">elm</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">elms</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">skip_opensees_definition</span>
    <span class="p">]</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">graphics_common_3d</span><span class="o">.</span><span class="n">global_layout</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">camera</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># draw the frames</span>
    <span class="n">add_data__frames_undeformed</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">list_of_line_elements</span><span class="p">)</span>
    <span class="c1"># we also add axes so that we can see 2D plots</span>
    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">global_axes</span><span class="p">:</span>
        <span class="n">add_data__global_axes</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span> <span class="n">ref_len</span><span class="p">)</span>

    <span class="c1"># Plot options:</span>
    <span class="c1"># a: axial</span>
    <span class="c1"># b: shear in local Y and Z</span>
    <span class="c1"># c: moment in Y and Z</span>
    <span class="c1"># d: torsion</span>
    <span class="c1"># e: shear combined</span>
    <span class="c1"># f: moment combined</span>
    <span class="n">x1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_b</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_c</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colors1_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">customdata_d</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># (we do this to determine the internal forces</span>
    <span class="c1">#  for all elements before we even start plotting</span>
    <span class="c1">#  them, to be able to compute a nice scaling factor</span>
    <span class="c1">#  without having to then recalculate the basic forces)</span>
    <span class="n">nx_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qy_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qz_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tx_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mz_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">my_vecs_min</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">nx_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qy_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">qz_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tx_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mz_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">my_vecs_max</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_basic_forces</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">df_min</span><span class="p">,</span> <span class="n">df_max</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">envelope_basic_forces</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

        <span class="c1"># store results in the preallocated arrays</span>

        <span class="n">nx_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;nx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qy_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;qy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qz_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;qz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">tx_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;tx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">my_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;my&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">mz_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">nx_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;nx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qy_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;qy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">qz_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;qz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">force_conversion</span>
        <span class="n">tx_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;tx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">my_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;my&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>
        <span class="n">mz_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_max</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">*</span> <span class="n">moment_conversion</span>

    <span class="c1"># calculate scaling factors</span>
    <span class="n">ref_len</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">reference_length</span><span class="p">()</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">nx_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">nx_vecs_min</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx_vecs_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">scaling_n</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">nx_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_n</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_t</span> <span class="o">=</span> <span class="mf">1.00</span>
    <span class="n">qy_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">qy_vecs_min</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">qy_vecs_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">qz_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">qz_vecs_min</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">qz_vecs_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">scaling_qy</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">qy_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="n">scaling_qz</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">qz_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_qy</span> <span class="o">&gt;</span> <span class="mf">0.00</span> <span class="ow">and</span> <span class="n">scaling_qz</span> <span class="o">&gt;</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">scaling_qy</span><span class="p">,</span> <span class="n">scaling_qz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scaling_qy</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">scaling_qz</span>
    <span class="k">elif</span> <span class="n">scaling_qz</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="n">scaling_qy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">if</span> <span class="n">scaling_q</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_q</span> <span class="o">=</span> <span class="mf">1.00</span>
    <span class="n">my_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">my_vecs_min</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">my_vecs_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mz_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">mz_vecs_min</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">mz_vecs_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">scaling_my</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">my_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="n">scaling_mz</span> <span class="o">=</span> <span class="n">force_scaling_factor</span><span class="p">(</span><span class="n">ref_len</span><span class="p">,</span> <span class="n">mz_max</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaling_my</span> <span class="o">&gt;</span> <span class="mf">0.00</span> <span class="ow">and</span> <span class="n">scaling_mz</span> <span class="o">&gt;</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">scaling_my</span><span class="p">,</span> <span class="n">scaling_mz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scaling_my</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">scaling_mz</span>
    <span class="k">elif</span> <span class="n">scaling_mz</span> <span class="o">==</span> <span class="mf">0.00</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="n">scaling_my</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">if</span> <span class="n">scaling_m</span> <span class="o">&gt;</span> <span class="mf">1.0e8</span><span class="p">:</span>
        <span class="n">scaling_m</span> <span class="o">=</span> <span class="mf">1.00</span>

    <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">list_of_line_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elm</span><span class="o">.</span><span class="n">visibility</span><span class="o">.</span><span class="n">hidden_basic_forces</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># retrieve results from the preallocated arrays</span>
        <span class="n">nx_vec_min</span> <span class="o">=</span> <span class="n">nx_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qy_vec_min</span> <span class="o">=</span> <span class="n">qy_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qz_vec_min</span> <span class="o">=</span> <span class="n">qz_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">tx_vec_min</span> <span class="o">=</span> <span class="n">tx_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">my_vec_min</span> <span class="o">=</span> <span class="n">my_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">mz_vec_min</span> <span class="o">=</span> <span class="n">mz_vecs_min</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>

        <span class="n">nx_vec_max</span> <span class="o">=</span> <span class="n">nx_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qy_vec_max</span> <span class="o">=</span> <span class="n">qy_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">qz_vec_max</span> <span class="o">=</span> <span class="n">qz_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">tx_vec_max</span> <span class="o">=</span> <span class="n">tx_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">my_vec_max</span> <span class="o">=</span> <span class="n">my_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">mz_vec_max</span> <span class="o">=</span> <span class="n">mz_vecs_max</span><span class="p">[</span><span class="n">elm</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">elm</span><span class="p">,</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">ElasticBeamColumn</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">DispBeamColumn</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">x_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">x_axis</span>
            <span class="n">y_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">y_axis</span>
            <span class="n">z_vec</span> <span class="o">=</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">z_axis</span>
            <span class="n">i_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_i</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">elm</span><span class="o">.</span><span class="n">geomtransf</span><span class="o">.</span><span class="n">offset_j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">i_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">x_vec</span><span class="p">,</span>
                <span class="n">y_vec</span><span class="p">,</span>
                <span class="n">z_vec</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">transformations</span><span class="o">.</span><span class="n">local_axes_from_points_and_angle</span><span class="p">(</span>
                <span class="n">p_i</span><span class="p">,</span> <span class="n">p_j</span><span class="p">,</span> <span class="mf">0.00</span>
            <span class="p">)</span>

        <span class="n">len_clr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p_i</span> <span class="o">-</span> <span class="n">p_j</span><span class="p">)</span>
        <span class="n">t_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">len_clr</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p_start</span> <span class="o">=</span> <span class="n">i_pos</span> <span class="o">+</span> <span class="n">t_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vec</span>
            <span class="n">p_end</span> <span class="o">=</span> <span class="n">i_pos</span> <span class="o">+</span> <span class="n">t_vec</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vec</span>

            <span class="c1"># axial load</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">nx_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">nx_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">nx_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">nx_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">nx_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_n</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">nx_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_a</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># torsion</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">tx_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">tx_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">tx_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tx_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">tx_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">tx_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_t</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_d</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">tx_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tx_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># shear load on y and z axes</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qy_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">qy_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qy_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qy_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qy_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">qy_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qy_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qy_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qz_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">qz_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qz_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qz_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">+</span> <span class="n">qz_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">+</span> <span class="n">qz_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_q</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_b</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">qz_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qz_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_b</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># moment around z and y axes</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">mz_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">-</span> <span class="n">mz_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="c1"># note: moments plotted upside down!</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">mz_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mz_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">mz_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">-</span> <span class="n">mz_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="c1"># note: moments plotted upside down!</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">mz_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mz_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="c1"># moment around y axis</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">my_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">-</span> <span class="n">my_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">my_vec_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">my_vec_min</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">p_i</span> <span class="o">=</span> <span class="n">p_start</span> <span class="o">-</span> <span class="n">my_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="n">p_j</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p_end</span> <span class="o">-</span> <span class="n">my_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_vec</span> <span class="o">*</span> <span class="n">scaling_m</span> <span class="o">*</span> <span class="n">scaling_global</span>
            <span class="p">)</span>
            <span class="n">x1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">y1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">z1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">p_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p_j</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">customdata_c</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">my_vec_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">my_vec_max</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">colors1_c</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">dt_a</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_a</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_a</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_a</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_a</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_a</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_b</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_b</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_b</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_b</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_b</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_b</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_c</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_c</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_c</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_c</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_c</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_c</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">dt_d</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x1_d</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y1_d</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z1_d</span><span class="p">,</span>
            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;customdata&quot;</span><span class="p">:</span> <span class="n">customdata_d</span><span class="p">,</span>
            <span class="s2">&quot;hovertemplate&quot;</span><span class="p">:</span> <span class="s2">&quot; %</span><span class="si">{customdata:.0f}</span><span class="s2">&lt;br&gt;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colors1_d</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="n">fig_datastructure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span> <span class="o">+</span> <span class="n">dt_a</span> <span class="o">+</span> <span class="n">dt_b</span> <span class="o">+</span> <span class="n">dt_c</span> <span class="o">+</span> <span class="n">dt_d</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">fig_datastructure</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
                <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Axial&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Shear&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Moment&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Torsion&quot;</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="p">(</span>
                                    <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                    <span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;pytest&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">to_html_file</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">to_html_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;scaling_n&quot;</span><span class="p">:</span> <span class="n">scaling_n</span><span class="p">,</span>
        <span class="s2">&quot;scaling_q&quot;</span><span class="p">:</span> <span class="n">scaling_q</span><span class="p">,</span>
        <span class="s2">&quot;scaling_m&quot;</span><span class="p">:</span> <span class="n">scaling_m</span><span class="p">,</span>
        <span class="s2">&quot;scaling_t&quot;</span><span class="p">:</span> <span class="n">scaling_t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">metadata</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">osmg</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips.html">Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Introductory Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/osmg.html">API reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, Ioannis Vouvakis Manousakis.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>