{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0f1bde5f",
   "metadata": {
    "cell_marker": "\"\"\""
   },
   "source": [
    "# Defining a Model\n",
    "\n",
    "This section demonstrates the model definition process.\n",
    "\n",
    "## Model Definition Overview\n",
    "\n",
    "The overall procedure for defining the elements of a model can be\n",
    "broken down into the following steps:\n",
    "\n",
    "- Set active levels\n",
    "\n",
    "- Define components\n",
    "\n",
    "- Execute pre-processing methods\n",
    "\n",
    "The model can be visualized at any step in the process to confirm its validity.\n",
    "\n",
    "**To see all the available arguments of each of the following methods,\n",
    "please read the API reference or their docstrings**.\n",
    "\n",
    "Alternatively, use the `help()` function inside a python shell.\n",
    "e.g. `help(mdl.add_level)`\n",
    "\n",
    "You can also use `pydoc <osmg.name_of_module>` in a terminal window."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9d806806",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# imports\n",
    "import numpy as np\n",
    "from osmg import model\n",
    "import osmg.defaults as defaults\n",
    "from osmg.gen.section_gen import SectionGenerator\n",
    "from osmg.ops.section import ElasticSection\n",
    "from osmg.gen.component_gen import BeamColumnGenerator\n",
    "from osmg.ops.element import ElasticBeamColumn\n",
    "from osmg.graphics.preprocessing_3d import show"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f53bbcb4",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Instantiate a model\n",
    "mdl = model.Model('example_model')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d69b6b79",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "help(mdl.add_level)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "eddc8839",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Define levels\n",
    "for i in range(3):\n",
    "    mdl.add_level(i, 144.00*(i))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0a996d38",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "defaults.load_default_steel(mdl)\n",
    "steel_phys_mat = mdl.physical_materials.retrieve_by_attr(\n",
    "    'name', 'default steel')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "975d8c68",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# define line element sections\n",
    "secg = SectionGenerator(mdl)\n",
    "secg.load_aisc_from_database(\n",
    "    'W',\n",
    "    [\"W24X94\"],\n",
    "    'default steel',\n",
    "    'default steel',\n",
    "    ElasticSection)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7a591c64",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# set active levels\n",
    "mdl.levels.set_active([1, 2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f9b265e1",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "p1 = np.array((0.00, 0.00))\n",
    "p2 = np.array((360., 0.00))\n",
    "p3 = np.array((360., 360.))\n",
    "p4 = np.array((0.00, 360.00))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8da1cf8f",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "mcg = BeamColumnGenerator(mdl)\n",
    "sec = mdl.elastic_sections.retrieve_by_attr('name', 'W24X94')\n",
    "for pt in [p1, p2, p3, p4]:\n",
    "    mcg.add_vertical_active(\n",
    "        x_coord=pt[0], y_coord=pt[1],\n",
    "        offset_i=np.zeros(3), offset_j=np.zeros(3),\n",
    "        transf_type='Corotational',\n",
    "        n_sub=4,\n",
    "        section=sec,\n",
    "        element_type=ElasticBeamColumn,\n",
    "        placement='centroid',\n",
    "        angle=0.00)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ad4736b4",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "for pair in ((p1, p2), (p2, p3), (p3, p4), (p4, p1)):\n",
    "    mcg.add_horizontal_active(\n",
    "        xi_coord=pair[0][0],\n",
    "        yi_coord=pair[0][1],\n",
    "        xj_coord=pair[1][0],\n",
    "        yj_coord=pair[1][1],\n",
    "        offset_i=np.zeros(3),\n",
    "        offset_j=np.zeros(3),\n",
    "        snap_i='centroid',\n",
    "        snap_j='centroid',\n",
    "        transf_type='Linear',\n",
    "        n_sub=4,\n",
    "        section=sec,\n",
    "        element_type=ElasticBeamColumn,\n",
    "        placement='top_center',\n",
    "        angle=0.00)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0c5235fd",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "show(mdl)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9e5501aa",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# fixing the base\n",
    "for node in mdl.levels[0].nodes.values():\n",
    "    node.restraint = [True, True, True, False, False, False]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d52a1641",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "show(mdl)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ea49aa0b",
   "metadata": {
    "cell_marker": "\"\"\""
   },
   "source": [
    "## Preprocessing"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "741c2a0f",
   "metadata": {
    "cell_marker": "\"\"\"",
    "lines_to_next_cell": 2
   },
   "source": [
    "Now that all the intended elements have been defined, we can apply\n",
    "pre-processing methods to the model.\n",
    "\n",
    "Some common methods are the following:\n",
    "\n",
    "* `rigid_diaphragms` assigns rigid diaphragm constraints to all\n",
    "  specified levels. Only primary nodes are affected (not internal\n",
    "  nodes of component assemblies).\n",
    "\n",
    "* `self_weight`, `self_mass` assign self-weight loads and lumped\n",
    "  self-mass to all the elements / nodes.\n",
    "\n",
    "Loads, mass, and diaphragm constraints are load_case-specific."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "22020be7",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# imports\n",
    "from osmg.load_case import LoadCase\n",
    "from osmg.preprocessing.self_weight_mass import self_weight\n",
    "from osmg.preprocessing.self_weight_mass import self_mass"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "08c9c4dc",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "testcase = LoadCase('test', mdl)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ff218046",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "self_weight(mdl, testcase)\n",
    "self_mass(mdl, testcase)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fdb26d62",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "testcase.rigid_diaphragms([1, 2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "51b0e7cc",
   "metadata": {},
   "outputs": [],
   "source": [
    "# visualize the model\n",
    "show(mdl, testcase, extrude=True)"
   ]
  }
 ],
 "metadata": {
  "jupytext": {
   "cell_markers": "\"\"\""
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
