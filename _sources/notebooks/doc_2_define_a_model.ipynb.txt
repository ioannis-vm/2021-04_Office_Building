{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "ccfae31a",
   "metadata": {
    "cell_marker": "\"\"\""
   },
   "source": [
    "# Defining a Model\n",
    "\n",
    "This section demonstrates the model definition process.\n",
    "\n",
    "## Model Definition Overview\n",
    "\n",
    "The overall procedure for defining the elements of a model can be broken down into the following steps:\n",
    "\n",
    "- Set active levels\n",
    "\n",
    "- Define components\n",
    "\n",
    "- Execute pre-processing methods\n",
    "\n",
    "The model can be visualized at any step in the process to confirm its validity.\n",
    "\n",
    "**To see all the available arguments of each of the following methods, please read the API reference or their docstrings**.\n",
    "\n",
    "Alternatively, use the `help()` function inside a python shell.\n",
    "e.g. `help(mdl.add_level)`\n",
    "\n",
    "You can also use `pydoc <osmg.name_of_module>` in a terminal window."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a2934648",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# imports\n",
    "import numpy as np\n",
    "from osmg import model\n",
    "import osmg.defaults as defaults\n",
    "from osmg.gen.section_gen import SectionGenerator\n",
    "from osmg.ops.section import ElasticSection\n",
    "from osmg.gen.component_gen import BeamColumnGenerator\n",
    "from osmg.ops.element import ElasticBeamColumn\n",
    "from osmg.graphics.preprocessing_3d import show"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5c01026c",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Instantiate a model\n",
    "mdl = model.Model('example_model')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "17032d88",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "help(mdl.add_level)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0f02dc59",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Define levels\n",
    "for i in range(3):\n",
    "    mdl.add_level(i, 144.00*(i))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5e9e80fd",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "defaults.load_default_steel(mdl)\n",
    "steel_phys_mat = mdl.physical_materials.retrieve_by_attr('name', 'default steel')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f93bc6f8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# define line element sections\n",
    "secg = SectionGenerator(mdl)\n",
    "secg.load_aisc_from_database(\n",
    "    'W',\n",
    "    [\"W24X94\"],\n",
    "    'default steel',\n",
    "    'default steel',\n",
    "    ElasticSection)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "aa28260c",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# set active levels\n",
    "mdl.levels.set_active([1, 2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "883100e0",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "p1 = np.array((0.00, 0.00))\n",
    "p2 = np.array((360., 0.00))\n",
    "p3 = np.array((360., 360.))\n",
    "p4 = np.array((0.00, 360.00))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e0a7cd64",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "mcg = BeamColumnGenerator(mdl)\n",
    "sec = mdl.elastic_sections.retrieve_by_attr('name', 'W24X94')\n",
    "for pt in [p1, p2, p3, p4]:\n",
    "    mcg.add_vertical_active(\n",
    "        x_coord=pt[0], y_coord=pt[1],\n",
    "        offset_i=np.zeros(3), offset_j=np.zeros(3),\n",
    "        transf_type='Corotational',\n",
    "        n_sub=4,\n",
    "        section=sec,\n",
    "        element_type=ElasticBeamColumn,\n",
    "        placement='centroid',\n",
    "        angle=0.00)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3827fc8d",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "for pair in ((p1, p2), (p2, p3), (p3, p4), (p4, p1)):\n",
    "    mcg.add_horizontal_active(\n",
    "        xi_coord=pair[0][0],\n",
    "        yi_coord=pair[0][1],\n",
    "        xj_coord=pair[1][0],\n",
    "        yj_coord=pair[1][1],\n",
    "        offset_i=np.zeros(3),\n",
    "        offset_j=np.zeros(3),\n",
    "        snap_i='centroid',\n",
    "        snap_j='centroid',\n",
    "        transf_type='Linear',\n",
    "        n_sub=4,\n",
    "        section=sec,\n",
    "        element_type=ElasticBeamColumn,\n",
    "        placement='top_center',\n",
    "        angle=0.00)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "39092428",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "show(mdl)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7756e96d",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# fixing the base\n",
    "for node in mdl.levels[0].nodes.values():\n",
    "    node.restraint = [True, True, True, False, False, False]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a34faf4b",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "show(mdl)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c6e33a23",
   "metadata": {
    "cell_marker": "\"\"\""
   },
   "source": [
    "# Preprocessing"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9e1bcb1f",
   "metadata": {
    "cell_marker": "\"\"\"",
    "lines_to_next_cell": 2
   },
   "source": [
    "Now that all the intended elements have been defined, we can apply pre-processing methods to the model.\n",
    "Some common methods are the following:\n",
    "\n",
    "- `rigid_diaphragms` assigns rigid diaphragm constraints to all levels that contain beams\n",
    "\n",
    "- `tributary_area_analysis` distributes loads from the floors to the supporting elements\n",
    "\n",
    "- `self_weight`, `self_mass` assign self-weight loads and lumped self-mass to all the elements.\n",
    "\n",
    "However, loads, mass, and diaphragm constraints are load_case-specific. We therefore need to define a load case first."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "13d1ed53",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# imports\n",
    "from osmg.load_case import LoadCase\n",
    "from osmg.preprocessing.self_weight_mass import self_weight\n",
    "from osmg.preprocessing.self_weight_mass import self_mass\n",
    "from osmg.preprocessing.tributary_area_analysis import PolygonLoad"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4e26e047",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "testcase = LoadCase('test', mdl)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "481473a5",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "self_weight(mdl, testcase)\n",
    "self_mass(mdl, testcase)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0784e8dd",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "testcase.rigid_diaphragms([1, 2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "18b21fb8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "for key in [1, 2]:\n",
    "    testcase.tributary_area_analysis[key].polygon_loads.append(\n",
    "        PolygonLoad('dead', 50.00, None, None, False))\n",
    "    testcase.tributary_area_analysis[key].polygon_loads.append(\n",
    "        PolygonLoad('live', 10.00, None, None, True))\n",
    "    testcase.tributary_area_analysis[key].run()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f1686f64",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# visualize the model\n",
    "show(mdl, testcase, extrude=True)"
   ]
  }
 ],
 "metadata": {
  "jupytext": {
   "cell_markers": "\"\"\""
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
